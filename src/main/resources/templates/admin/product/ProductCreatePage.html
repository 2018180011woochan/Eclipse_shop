<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<html>
<head><title>상품 등록</title></head>
<body>
	<h2>상품 등록 페이지</h2>
	
	<form th:action="@{/admin/products/create}" method="post"  enctype="multipart/form-data">
		<div>
			<label for="name">상품 이름:</label>
			<input type="text" id="name" name="name" placeholder="상품 이름을 입력하세요" required>
		</div>
		<div>
			<label for="price">가격:</label>
			<input type="number" id="price" name="price" placeholder="가격을 입력하세요" required>
		</div>
		<div>
			<label for="description">상세 설명:</label>
			<input type="text" id="description" name="description" placeholder="상세 설명을 입력하세요" required>
		</div>
		
		 <!-- 카테고리 선택 -->
        <div>
            <label for="mainCategory">메인카테고리:</label>
            <select id="mainCategory" name="mainCategory" required>
                <option value="">메인카테고리를 선택하세요</option>
                <!-- 서버에서 제공된 메인카테고리 데이터 -->
                <option th:each="mainCategory : ${mainCategories}" 
                        th:value="${mainCategory.categoryId}" 
                        th:text="${mainCategory.name}">
                </option>
            </select>
        </div>

        <div>
            <label for="subCategory">서브카테고리:</label>
            <select id="subCategory" name="categoryId" required>
                <option value="">서브카테고리를 선택하세요</option>
                <!-- JavaScript로 동적 로드 -->
            </select>
        </div>
		
		<div id="options">
			<label>옵션 추가</label>
			<div class="option">
				<label>사이즈</label>
				<select name="options[0].size" required>
					<option value="S">S</option>
					<option value="M">M</option>
					<option value="L">L</option>
					<option value="XL">XL</option>
				</select>
				
				<label>색상</label>
				<input type="text" name="options[0].color" placeholder="색상을 입력하세요" required>
				
				<label>재고 수량</label>
        		<input type="number" name="options[0].stockQuantity" min="1" required>
			</div>
		</div>
		<button type="button" id="addOption">옵션 추가</button>
		
		<div>
			<label for="images">이미지 추가</label>
			<input type="file" id="images" name="images" accept="image/*" multiple required>
		</div>
		<button type="submit">상품 등록</button>
		
	</form>
	<script src="/product/js/createProduct.js"></script>
	<script>
        document.getElementById("mainCategory").addEventListener("change", function () {
            const mainCategoryId = this.value;

            // AJAX 요청으로 서브카테고리 가져오기
            fetch(`/api/admin/category/${mainCategoryId}/subcategorys`)
                .then(response => response.json())
                .then(data => {
                    const subCategorySelect = document.getElementById("subCategory");
                    subCategorySelect.innerHTML = '<option value="">서브카테고리를 선택하세요</option>'; // 초기화

                    data.forEach(subCategory => {
                        const option = document.createElement("option");
                        option.value = subCategory.categoryId;
                        option.textContent = subCategory.name;
                        subCategorySelect.appendChild(option);
                    });
                })
                .catch(error => console.error("Error loading subcategories:", error));
        });
    </script>
</body>
</html>